<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«ä¹å°é’Ÿè¡¨ - æ•°å­¦æ€ç»´æŒ‘æˆ˜</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&family=ZCOOL+KuaiLe&display=swap');
        
        :root {
            --primary-sun: #fbbf24;
            --secondary-sky: #3b82f6;
        }

        body { 
            font-family: 'Noto Sans SC', 'ZCOOL KuaiLe', sans-serif;
            background-color: #f8fafc;
            background-image: radial-gradient(#e2e8f0 1.5px, transparent 1.5px);
            background-size: 24px 24px;
        }

        .clock-face {
            background: radial-gradient(circle, #ffffff 0%, #fffbeb 100%);
            box-shadow: 
                0 10px 25px -5px rgba(0, 0, 0, 0.1),
                inset 0 0 20px rgba(251, 191, 36, 0.1);
        }

        .hand-transition {
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 32px;
            height: 32px;
            background: #fff;
            border: 4px solid #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .bounce-success {
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .math-bubble {
            position: relative;
            background: #eff6ff;
            border: 3px solid #bfdbfe;
        }

        .math-bubble::after {
            content: '';
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 10px 15px 10px 0;
            border-color: transparent #bfdbfe transparent transparent;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icons = {
            Clock: () => <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Trophy: () => <svg viewBox="0 0 24 24" width="24" height="24" fill="#fbbf24"><path d="M8 21h8m-4-4v4M7 4h10m1 3c1.1 0 2 .9 2 2v2c0 1.1-.9 2-2 2h-1c-.5 2.5-2 4.5-4 5.5v.5H9v-.5c-2-1-3.5-3-4-5.5H4c-1.1 0-2-.9-2-2V9c0-1.1.9-2 2-2h1V4h14v3z"/></svg>,
            Calculator: () => <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2.5"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14.01"/><line x1="12" y1="14" x2="12" y2="14.01"/><line x1="8" y1="14" x2="8" y2="14.01"/><line x1="16" y1="18" x2="16" y2="18.01"/><line x1="12" y1="18" x2="12" y2="18.01"/><line x1="8" y1="18" x2="8" y2="18.01"/></svg>,
            Flower: () => <span className="text-3xl">ğŸŒº</span>,
            Speaker: () => <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M14 5v14l-4.5-4.5H6V9.5h3.5L14 5zM16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
        };

        const App = () => {
            const [time, setTime] = useState(new Date());
            const [view, setView] = useState('explore'); 
            const [manualHours, setManualHours] = useState(10);
            const [manualMinutes, setManualMinutes] = useState(0);
            const [quiz, setQuiz] = useState({
                question: "æŠŠé’Ÿè¡¨è°ƒåˆ° 3 ç‚¹æ•´å§ï¼",
                targetH: 3,
                targetM: 0
            });
            const [feedback, setFeedback] = useState(null);
            const [score, setScore] = useState(0);
            const [aiStory, setAiStory] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const apiKey = ""; 

            // Time update for explore mode
            useEffect(() => {
                if (view === 'explore') {
                    const timer = setInterval(() => setTime(new Date()), 1000);
                    return () => clearInterval(timer);
                }
            }, [view]);

            const displayH = view === 'quiz' ? manualHours : (view === 'explore' ? time.getHours() % 12 || 12 : manualHours);
            const displayM = view === 'quiz' ? manualMinutes : (view === 'explore' ? time.getMinutes() : manualMinutes);

            const hourDeg = (displayH % 12) * 30 + displayM * 0.5;
            const minDeg = displayM * 6;

            // Generate new math-based quiz
            const generateQuiz = () => {
                setFeedback(null);
                const baseH = Math.floor(Math.random() * 12) || 12;
                const type = Math.random() > 0.5 ? 'add' : 'sub';
                const offset = [1, 2, 3][Math.floor(Math.random() * 3)];
                const useMinutes = Math.random() > 0.7; // 30% chance for half-hour math
                
                let targetH, targetM, question;

                if (useMinutes) {
                    question = `ç°åœ¨æ˜¯ ${baseH}:00ï¼Œå†è¿‡ 30 åˆ†é’Ÿæ˜¯å‡ ç‚¹ï¼Ÿ`;
                    targetH = baseH;
                    targetM = 30;
                } else {
                    if (type === 'add') {
                        question = `ç°åœ¨æ˜¯ ${baseH} ç‚¹ï¼Œå†è¿‡ ${offset} å°æ—¶æ˜¯å‡ ç‚¹ï¼Ÿ`;
                        targetH = (baseH + offset) % 12 || 12;
                        targetM = 0;
                    } else {
                        question = `ç°åœ¨æ˜¯ ${baseH} ç‚¹ï¼Œ${offset} å°æ—¶å‰æ˜¯å‡ ç‚¹ï¼Ÿ`;
                        targetH = (baseH - offset + 12) % 12 || 12;
                        targetM = 0;
                    }
                }

                setQuiz({ question, targetH, targetM });
                setManualHours(12);
                setManualMinutes(0);
            };

            const checkAnswer = () => {
                const isCorrectH = (manualHours % 12) === (quiz.targetH % 12);
                const isCorrectM = manualMinutes === quiz.targetM;

                if (isCorrectH && isCorrectM) {
                    setFeedback({ type: 'success', text: "å¤ªèªæ˜äº†ï¼åŠ å‡æ³•ä¹Ÿéš¾ä¸å€’ä½ ï¼ğŸŒŸ" });
                    setScore(s => s + 1);
                } else {
                    setFeedback({ type: 'error', text: "å“å‘€ï¼Œç®—é”™äº†æˆ–æ˜¯æŒ‡é’ˆæ²¡å¯¹å‡†ï¼Œå†æ•°æ•°çœ‹ï¼ŸğŸ”" });
                }
            };

            const callGemini = async (url, payload) => {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                return await res.json();
            };

            const playTts = async () => {
                const text = `å°æœ‹å‹è¯·å¬é¢˜ï¼š${quiz.question}`;
                try {
                    const res = await callGemini(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`,
                        {
                            contents: [{ parts: [{ text: `Say warmly: ${text}` }] }],
                            generationConfig: {
                                responseModalities: ["AUDIO"],
                                speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } } }
                            },
                            model: "gemini-2.5-flash-preview-tts"
                        }
                    );
                    const audioData = res.candidates[0].content.parts[0].inlineData.data;
                    const audioBlob = pcmToWav(audioData, 24000);
                    new Audio(URL.createObjectURL(audioBlob)).play();
                } catch (e) {}
            };

            const pcmToWav = (base64, rate) => {
                const s = window.atob(base64), b = new Uint8Array(s.length), h = new ArrayBuffer(44), d = new DataView(h);
                for (let i = 0; i < s.length; i++) b[i] = s.charCodeAt(i);
                const st = (o, s) => { for (let i = 0; i < s.length; i++) d.setUint8(o + i, s.charCodeAt(i)); };
                st(0, 'RIFF'); d.setUint32(4, 36 + s.length, true); st(8, 'WAVE'); st(12, 'fmt ');
                d.setUint32(16, 16, true); d.setUint16(20, 1, true); d.setUint16(22, 1, true);
                d.setUint32(24, rate, true); d.setUint32(28, rate * 2, true); d.setUint16(32, 2, true);
                d.setUint16(34, 16, true); st(36, 'data'); d.setUint32(40, s.length, true);
                return new Blob([h, b], { type: 'audio/wav' });
            };

            return (
                <div className="min-h-screen p-4 md:p-10 flex flex-col items-center">
                    {/* Header Score Board */}
                    <div className="max-w-5xl w-full mb-8 flex justify-between items-center bg-white p-4 rounded-3xl shadow-sm border-b-4 border-amber-200">
                        <div className="flex items-center gap-3">
                            <div className="bg-amber-400 p-2 rounded-xl text-white shadow-md"><Icons.Trophy /></div>
                            <div>
                                <p className="text-xs text-slate-400 font-bold uppercase tracking-wider">æˆ‘çš„æˆå°±</p>
                                <p className="text-xl font-black text-amber-600">è·å¾— {score} æœµå°çº¢èŠ±</p>
                            </div>
                        </div>
                        <div className="flex bg-slate-100 p-1.5 rounded-2xl">
                            <button 
                                onClick={() => {setView('explore'); setFeedback(null);}} 
                                className={`px-6 py-2 rounded-xl text-sm font-bold transition ${view === 'explore' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}
                            >è‡ªç”±è§‚å¯Ÿ</button>
                            <button 
                                onClick={() => {setView('quiz'); generateQuiz();}} 
                                className={`px-6 py-2 rounded-xl text-sm font-bold transition ${view === 'quiz' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}
                            >æŒ‘æˆ˜ä»»åŠ¡</button>
                        </div>
                    </div>

                    <div className="max-w-5xl w-full grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                        
                        {/* Left: Clock Column */}
                        <div className="lg:col-span-7 flex flex-col items-center bg-white rounded-[50px] p-8 md:p-12 shadow-2xl border-b-8 border-slate-200 relative overflow-hidden">
                            {/* Decorative Sun Rays */}
                            <div className="absolute -top-10 -left-10 w-40 h-40 bg-amber-100/50 rounded-full blur-3xl" />
                            
                            {/* Clock Dial */}
                            <div className="relative w-72 h-72 md:w-[400px] md:h-[400px] rounded-full clock-face border-[16px] border-amber-400 shadow-2xl flex items-center justify-center">
                                {/* Center Bolt */}
                                <div className="absolute w-6 h-6 bg-amber-600 rounded-full z-50 border-4 border-white shadow-lg" />
                                
                                {/* Numbers (Formal & Large) */}
                                {[...Array(12)].map((_, i) => (
                                    <div key={i} className="absolute inset-6 text-center" style={{ transform: `rotate(${(i + 1) * 30}deg)` }}>
                                        <span className="inline-block font-black text-3xl md:text-5xl text-slate-800" style={{ transform: `rotate(-${(i + 1) * 30}deg)` }}>
                                            {i + 1}
                                        </span>
                                    </div>
                                ))}

                                {/* Minute Markers (Professional Track) */}
                                {[...Array(60)].map((_, i) => (
                                    <div 
                                        key={i} 
                                        className="absolute bg-slate-300" 
                                        style={{ 
                                            width: i % 5 === 0 ? '4px' : '2px', 
                                            height: i % 5 === 0 ? '15px' : '8px', 
                                            bottom: '50%', 
                                            left: '50%', 
                                            transformOrigin: 'bottom center', 
                                            transform: `translateX(-50%) rotate(${i * 6}deg) translateY(-${i % 5 === 0 ? 170 : 175}px)` 
                                        }} 
                                    />
                                ))}

                                {/* Hands */}
                                <div className="hand-transition absolute bg-slate-800 rounded-full shadow-md" style={{ width: '14px', height: '110px', bottom: '50%', transformOrigin: 'bottom', transform: `rotate(${hourDeg}deg)`, zIndex: 20 }} />
                                <div className="hand-transition absolute bg-blue-500 rounded-full shadow-md" style={{ width: '8px', height: '160px', bottom: '50%', transformOrigin: 'bottom', transform: `rotate(${minDeg}deg)`, zIndex: 30 }} />
                            </div>

                            {/* Digital Display */}
                            <div className="mt-12 flex items-center gap-6">
                                <div className="bg-slate-900 text-white px-10 py-4 rounded-[30px] text-6xl font-black tracking-tighter shadow-2xl border-4 border-slate-700">
                                    {displayH.toString().padStart(2, '0')}<span className="text-amber-400 opacity-80">:</span>{displayM.toString().padStart(2, '0')}
                                </div>
                            </div>
                        </div>

                        {/* Right: Interaction Column */}
                        <div className="lg:col-span-5 space-y-6">
                            
                            {/* Task Panel */}
                            <div className="bg-white rounded-[40px] p-8 shadow-xl border-t-8 border-blue-400">
                                {view === 'quiz' ? (
                                    <div className="space-y-6">
                                        <div className="flex items-start gap-4">
                                            <div className="bg-blue-100 p-3 rounded-2xl text-blue-600"><Icons.Calculator /></div>
                                            <div className="math-bubble p-5 rounded-3xl flex-1">
                                                <p className="text-lg font-bold text-blue-900 leading-snug">
                                                    {quiz.question}
                                                </p>
                                                <button onClick={playTts} className="mt-2 text-xs text-blue-500 font-bold flex items-center gap-1 hover:underline">
                                                    <Icons.Speaker /> è¯­éŸ³å¬é¢˜
                                                </button>
                                            </div>
                                        </div>

                                        <div className="space-y-8 py-4">
                                            <div className="space-y-3">
                                                <div className="flex justify-between font-black text-slate-400 text-xs tracking-widest uppercase">
                                                    <span>æ‹¨åŠ¨æ—¶é’ˆ</span>
                                                    <span className="text-amber-500 text-lg">{manualHours} ç‚¹</span>
                                                </div>
                                                <input type="range" min="1" max="12" value={manualHours} onChange={e => {setManualHours(parseInt(e.target.value)); setFeedback(null);}} className="w-full h-3 bg-slate-100 rounded-full appearance-none cursor-pointer accent-amber-500" />
                                            </div>
                                            <div className="space-y-3">
                                                <div className="flex justify-between font-black text-slate-400 text-xs tracking-widest uppercase">
                                                    <span>æ‹¨åŠ¨åˆ†é’ˆ</span>
                                                    <span className="text-blue-500 text-lg">{manualMinutes} åˆ†</span>
                                                </div>
                                                <input type="range" min="0" max="59" value={manualMinutes} onChange={e => {setManualMinutes(parseInt(e.target.value)); setFeedback(null);}} className="w-full h-3 bg-slate-100 rounded-full appearance-none cursor-pointer accent-blue-500" />
                                            </div>
                                        </div>

                                        <button 
                                            onClick={checkAnswer}
                                            className="w-full py-5 bg-blue-600 text-white text-xl font-black rounded-3xl shadow-lg shadow-blue-200 hover:bg-blue-700 transition active:scale-95"
                                        >
                                            æ‹¨å¥½äº†ï¼å¿«æ£€æŸ¥ç»“æœ
                                        </button>
                                        
                                        {feedback && (
                                            <div className={`p-5 rounded-3xl text-center font-bold text-lg animate-bounce-in border-4 ${feedback.type === 'success' ? 'bg-green-50 border-green-200 text-green-700 bounce-success' : 'bg-red-50 border-red-200 text-red-600'}`}>
                                                {feedback.text}
                                            </div>
                                        )}
                                        
                                        {feedback?.type === 'success' && (
                                            <button onClick={generateQuiz} className="w-full py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl hover:bg-slate-200">
                                                ä¸‹ä¸€å…³æŒ‘æˆ˜ â”
                                            </button>
                                        )}
                                    </div>
                                ) : (
                                    <div className="text-center py-10 space-y-6">
                                        <div className="w-20 h-20 bg-amber-50 rounded-full flex items-center justify-center mx-auto border-4 border-amber-200">
                                            <Icons.Clock />
                                        </div>
                                        <div>
                                            <h3 className="text-2xl font-black text-slate-800">è‡ªç”±è§‚å¯Ÿæ—¶é—´</h3>
                                            <p className="text-slate-400 mt-2">ç‚¹å‡»å³ä¾§çš„â€œæŒ‘æˆ˜ä»»åŠ¡â€æ¥è·å¾—å°çº¢èŠ±å§ï¼</p>
                                        </div>
                                        <div className="p-4 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 text-sm text-slate-500 leading-relaxed">
                                            æç¤ºï¼šåœ¨è‡ªç”±æ¨¡å¼ä¸‹ï¼Œé’Ÿè¡¨ä¼šè·Ÿéšç°åœ¨çš„çœŸå®æ—¶é—´èµ°åŠ¨å“¦ï¼
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Rewards Wall */}
                            <div className="bg-white rounded-[40px] p-6 shadow-xl border-b-4 border-rose-200">
                                <h4 className="font-black text-rose-500 mb-4 flex items-center gap-2">æˆ‘çš„å°çº¢èŠ±å¥–çŠ¶</h4>
                                <div className="flex flex-wrap gap-2 min-h-[60px] bg-rose-50/50 p-4 rounded-3xl">
                                    {[...Array(score)].map((_, i) => (
                                        <span key={i} className="inline-block animate-in zoom-in duration-300"><Icons.Flower /></span>
                                    ))}
                                    {score === 0 && <span className="text-xs text-rose-300 italic font-bold">è¿˜æ²¡æœ‰è·å¾—å¥–ç« ï¼ŒåŠ æ²¹å“¦ï¼</span>}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
