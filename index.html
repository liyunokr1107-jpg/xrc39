<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÆ§ËØÜÈíüË°®Â≠¶‰π†Â∑•ÂÖ∑ - ‰ºòÂåñÁâà</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            background: white;
            border: 3px solid currentColor;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .clock-shadow {
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1), 0 10px 30px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // SVG Icons
        const Icons = {
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Gamepad2: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="6" y1="12" x2="10" y2="12"/><line x1="8" y1="10" x2="8" y2="14"/><rect x="2" y="6" width="20" height="12" rx="2"/><line x1="15" y1="13" x2="15.01" y2="13"/><line x1="18" y1="11" x2="18.01" y2="11"/></svg>,
            RotateCcw: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><polyline points="3 3 3 8 8 8"/></svg>,
            Sparkles: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
            Volume2: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>,
            Loader2: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin"><path d="M12 2v4"/><path d="m16.2 7.8 2.9-2.9"/><path d="M18 12h4"/><path d="m16.2 16.2 2.9 2.9"/><path d="M12 18v4"/><path d="m4.9 19.1 2.9-2.9"/><path d="M2 12h4"/><path d="m4.9 4.9 2.9 2.9"/></svg>
        };

        const App = () => {
            const [time, setTime] = useState(new Date());
            const [isManual, setIsManual] = useState(false);
            const [manualHours, setManualHours] = useState(10);
            const [manualMinutes, setManualMinutes] = useState(0);
            const [view, setView] = useState('explore'); 
            const [quizTask, setQuizTask] = useState({ h: 3, m: 0 });
            const [feedback, setFeedback] = useState(null);
            const [aiStory, setAiStory] = useState('');
            const [isGeneratingStory, setIsGeneratingStory] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const apiKey = ""; 

            // Live clock logic
            useEffect(() => {
                if (!isManual && view === 'explore') {
                    const timer = setInterval(() => setTime(new Date()), 1000);
                    return () => clearInterval(timer);
                }
            }, [isManual, view]);

            const h = (isManual || view === 'quiz') ? manualHours : time.getHours();
            const m = (isManual || view === 'quiz') ? manualMinutes : time.getMinutes();
            const s = (isManual || view === 'quiz') ? 0 : time.getSeconds();

            const hourDeg = (h % 12) * 30 + m * 0.5;
            const minDeg = m * 6;
            const secDeg = s * 6;

            const callGemini = async (url, payload, retries = 5, delay = 1000) => {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (response.ok) return await response.json();
                    } catch (e) {
                        if (i === retries - 1) throw e;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            };

            const generateTimeStory = async () => {
                setIsGeneratingStory(true);
                setAiStory('');
                const prompt = `Áé∞Âú®ÊòØÈíüË°®‰∏äÁöÑ ${h}ÁÇπ${m}ÂàÜ„ÄÇËØ∑‰∏∫‰∏Ä‰∏™Â∞èÂ≠©Â≠êÂÜô‰∏Ä‰∏™ÈùûÂ∏∏ÁÆÄÁü≠Ôºà2Âè•ËØù‰ª•ÂÜÖÔºâÁöÑÊúâË∂£Â∞èÊïÖ‰∫ãÔºåÊèèËø∞Ëøô‰∏™Êó∂Èó¥ÁÇπÈÄöÂ∏∏Âú®ÂèëÁîü‰ªÄ‰πà„ÄÇËØ≠Ê∞îË¶Å‰∫≤Âàá„ÄÅÁîüÂä®„ÄÇ`;
                try {
                    const result = await callGemini(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        {
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: "‰Ω†ÊòØ‰∏Ä‰ΩçÊ∏©ÂíåÁöÑÂπºÂÑøÂõ≠ËÄÅÂ∏àÔºåÊìÖÈïøÁªôÂ≠©Â≠ê‰ª¨ËÆ≤Êó∂Èó¥ÁöÑÊïÖ‰∫ã„ÄÇ" }] }
                        }
                    );
                    setAiStory(result.candidates?.[0]?.content?.parts?.[0]?.text);
                } catch (error) {
                    setAiStory("ÂìéÂëÄÔºåÈ≠îÊ≥ïÊöÇÊó∂Â§±ÁÅµ‰∫Ü„ÄÇÂª∫ËÆÆÊ£ÄÊü•ÁΩëÁªúËøûÊé•„ÄÇ");
                } finally {
                    setIsGeneratingStory(false);
                }
            };

            const playTts = async () => {
                setIsSpeaking(true);
                const textToSay = `Áé∞Âú®ÊòØ ${h}ÁÇπ ${m === 0 ? 'Êï¥' : m + 'ÂàÜ'}„ÄÇ`;
                try {
                    const result = await callGemini(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`,
                        {
                            contents: [{ parts: [{ text: `Say warmly: ${textToSay}` }] }],
                            generationConfig: {
                                responseModalities: ["AUDIO"],
                                speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } } }
                            },
                            model: "gemini-2.5-flash-preview-tts"
                        }
                    );
                    const audioData = result.candidates[0].content.parts[0].inlineData.data;
                    const binaryString = window.atob(audioData);
                    const len = binaryString.length;
                    const bytes = new Uint8Array(len);
                    for (let i = 0; i < len; i++) bytes[i] = binaryString.charCodeAt(i);
                    const wavHeader = new ArrayBuffer(44);
                    const dv = new DataView(wavHeader);
                    const srt = (off, s) => { for (let i = 0; i < s.length; i++) dv.setUint8(off + i, s.charCodeAt(i)); };
                    srt(0, 'RIFF'); dv.setUint32(4, 36 + len, true); srt(8, 'WAVE'); srt(12, 'fmt ');
                    dv.setUint32(16, 16, true); dv.setUint16(20, 1, true); dv.setUint16(22, 1, true);
                    dv.setUint32(24, 24000, true); dv.setUint32(28, 48000, true); dv.setUint16(32, 2, true);
                    dv.setUint16(34, 16, true); srt(36, 'data'); dv.setUint32(40, len, true);
                    const audioUrl = URL.createObjectURL(new Blob([wavHeader, bytes], { type: 'audio/wav' }));
                    const audio = new Audio(audioUrl);
                    audio.onended = () => setIsSpeaking(false);
                    await audio.play();
                } catch (error) {
                    setIsSpeaking(false);
                }
            };

            const generateQuiz = () => {
                const hours = Math.floor(Math.random() * 12) || 12;
                const minutes = [0, 5, 10, 15, 20, 30, 40, 45, 50, 55][Math.floor(Math.random() * 10)];
                setQuizTask({ h: hours, m: minutes });
                setManualHours(12);
                setManualMinutes(0);
                setFeedback(null);
                setAiStory('');
            };

            const checkQuiz = () => {
                const isCorrectH = (manualHours % 12) === (quizTask.h % 12);
                const isCorrectM = manualMinutes === quizTask.m;
                if (isCorrectH && isCorrectM) {
                    setFeedback({ type: 'success', text: 'üéâ Â§™Ê£í‰∫ÜÔºÅÂÆåÂÖ®Ê≠£Á°ÆÔºÅ' });
                } else {
                    setFeedback({ type: 'error', text: '‚ùå ÊåáÈíà‰ΩçÁΩÆ‰∏çÂØπÂì¶ÔºåÂÜç‰ªîÁªÜËßÇÂØü‰∏Ä‰∏ã„ÄÇ' });
                }
            };

            const adjustTime = (type, amount) => {
                if (type === 'h') {
                    setManualHours(prev => {
                        let next = prev + amount;
                        if (next > 12) return 1;
                        if (next < 1) return 12;
                        return next;
                    });
                } else {
                    setManualMinutes(prev => {
                        let next = prev + amount;
                        if (next >= 60) return next - 60;
                        if (next < 0) return next + 60;
                        return next;
                    });
                }
                setFeedback(null);
            };

            const Hand = ({ deg, length, width, color, zIndex = 10 }) => (
                <div
                    className="absolute transition-transform duration-500 ease-out"
                    style={{
                        width: `${width}px`,
                        height: `${length}px`,
                        backgroundColor: color,
                        bottom: '50%',
                        left: '50%',
                        transformOrigin: 'bottom center',
                        transform: `translateX(-50%) rotate(${deg}deg)`,
                        borderRadius: '10px',
                        zIndex: zIndex
                    }}
                />
            );

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 flex flex-col items-center font-sans text-slate-800">
                    <div className="max-w-4xl w-full flex flex-col lg:flex-row gap-6">
                        
                        {/* Clock Side */}
                        <div className="flex-1 bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100 flex flex-col">
                            <div className="bg-indigo-600 p-6 text-white flex justify-between items-center">
                                <h1 className="text-xl font-bold flex items-center gap-2">
                                    <Icons.Clock /> ËÆ§ËØÜÈíüË°®
                                </h1>
                                <div className="flex bg-indigo-700 rounded-xl p-1">
                                    <button 
                                        onClick={() => { setView('explore'); setIsManual(false); setFeedback(null); }} 
                                        className={`px-4 py-2 rounded-lg transition flex items-center gap-2 text-sm font-bold ${view === 'explore' ? 'bg-white text-indigo-600' : 'text-indigo-100 hover:bg-indigo-500'}`}
                                    >
                                        <Icons.BookOpen /> Ëá™Áî±Êé¢Á¥¢
                                    </button>
                                    <button 
                                        onClick={() => { setView('quiz'); setIsManual(true); generateQuiz(); }} 
                                        className={`px-4 py-2 rounded-lg transition flex items-center gap-2 text-sm font-bold ${view === 'quiz' ? 'bg-white text-indigo-600' : 'text-indigo-100 hover:bg-indigo-500'}`}
                                    >
                                        <Icons.Gamepad2 /> ÊåëÊàòÁªÉ‰π†
                                    </button>
                                </div>
                            </div>

                            <div className="p-8 flex flex-col items-center justify-center flex-1">
                                {/* Analog Clock Face */}
                                <div className="relative w-64 h-64 md:w-80 md:h-80 bg-white border-[12px] border-slate-800 rounded-full clock-shadow flex items-center justify-center mb-8">
                                    <div className="absolute w-5 h-5 bg-slate-800 rounded-full z-50 border-2 border-white" />
                                    {[...Array(12)].map((_, i) => (
                                        <div key={i} className="absolute inset-4 text-center" style={{ transform: `rotate(${(i + 1) * 30}deg)` }}>
                                            <span className="inline-block font-black text-2xl md:text-3xl" style={{ transform: `rotate(-${(i + 1) * 30}deg)` }}>{i + 1}</span>
                                        </div>
                                    ))}
                                    {[...Array(60)].map((_, i) => (
                                        <div key={i} className="absolute w-1 bg-slate-300" style={{ height: i % 5 === 0 ? '12px' : '6px', bottom: '50%', left: '50%', transformOrigin: 'bottom center', transform: `translateX(-50%) rotate(${i * 6}deg) translateY(-${i % 5 === 0 ? 110 : 115}px)` }} />
                                    ))}
                                    <Hand deg={hourDeg} length={70} width={10} color="#1e293b" zIndex={20} />
                                    <Hand deg={minDeg} length={110} width={6} color="#4f46e5" zIndex={30} />
                                    {(view === 'explore' && !isManual) && <Hand deg={secDeg} length={120} width={2} color="#ef4444" zIndex={40} />}
                                </div>

                                {/* Digital Display */}
                                <div className="flex items-center gap-4 mb-4">
                                    <div className="bg-slate-100 px-8 py-3 rounded-2xl text-4xl font-mono font-black text-slate-800 tracking-tighter ring-4 ring-slate-100">
                                        {h.toString().padStart(2, '0')}<span className="animate-pulse">:</span>{m.toString().padStart(2, '0')}
                                    </div>
                                    <button 
                                        onClick={playTts} 
                                        disabled={isSpeaking}
                                        className={`p-4 rounded-full shadow-lg transition-all active:scale-90 ${isSpeaking ? 'bg-indigo-100 text-indigo-400' : 'bg-indigo-500 text-white hover:bg-indigo-600'}`}
                                    >
                                        {isSpeaking ? <Icons.Loader2 /> : <Icons.Volume2 />}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Control Side */}
                        <div className="w-full lg:w-96 flex flex-col gap-6">
                            
                            {/* Adjustment Controls */}
                            <div className="bg-white rounded-3xl p-6 shadow-xl border border-slate-100 space-y-6">
                                {view === 'quiz' && (
                                    <div className="bg-indigo-50 p-4 rounded-2xl border-2 border-indigo-200 text-center animate-in zoom-in duration-300">
                                        <p className="text-sm font-bold text-indigo-700 mb-1">ËØ∑Êã®Âä®ÊåáÈíàÂà∞Ôºö</p>
                                        <p className="text-4xl font-black text-indigo-600 tracking-tight">{quizTask.h}:{quizTask.m.toString().padStart(2, '0')}</p>
                                    </div>
                                )}

                                <div className="space-y-6">
                                    {/* Hour Control */}
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-end">
                                            <span className="text-sm font-bold text-slate-500">Ë∞ÉÊï¥Â∞èÊó∂ (1-12)</span>
                                            <span className="text-lg font-black text-slate-800 bg-slate-100 px-3 rounded-lg">{manualHours}</span>
                                        </div>
                                        <input 
                                            type="range" min="1" max="12" step="1"
                                            value={manualHours} 
                                            onChange={(e) => {setManualHours(parseInt(e.target.value)); setFeedback(null);}} 
                                            className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800"
                                        />
                                        <div className="flex gap-2">
                                            <button onClick={() => adjustTime('h', -1)} className="flex-1 py-2 bg-slate-50 rounded-xl hover:bg-slate-100 border border-slate-200 font-bold text-slate-600 transition">-1Êó∂</button>
                                            <button onClick={() => adjustTime('h', 1)} className="flex-1 py-2 bg-slate-50 rounded-xl hover:bg-slate-100 border border-slate-200 font-bold text-slate-600 transition">+1Êó∂</button>
                                        </div>
                                    </div>

                                    {/* Minute Control - OPTIMIZED */}
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-end">
                                            <span className="text-sm font-bold text-indigo-600">Ë∞ÉÊï¥ÂàÜÈíü (0-59)</span>
                                            <span className="text-lg font-black text-white bg-indigo-500 px-3 rounded-lg">{m} ÂàÜ</span>
                                        </div>
                                        <input 
                                            type="range" min="0" max="59" step="1"
                                            value={manualMinutes} 
                                            onChange={(e) => {setManualMinutes(parseInt(e.target.value)); setFeedback(null);}} 
                                            className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"
                                        />
                                        <div className="grid grid-cols-4 gap-2">
                                            <button onClick={() => adjustTime('m', -5)} className="py-2 bg-indigo-50 rounded-xl hover:bg-indigo-100 text-indigo-600 font-bold text-xs">-5ÂàÜ</button>
                                            <button onClick={() => adjustTime('m', -1)} className="py-2 bg-indigo-50 rounded-xl hover:bg-indigo-100 text-indigo-600 font-bold text-xs">-1ÂàÜ</button>
                                            <button onClick={() => adjustTime('m', 1)} className="py-2 bg-indigo-50 rounded-xl hover:bg-indigo-100 text-indigo-600 font-bold text-xs">+1ÂàÜ</button>
                                            <button onClick={() => adjustTime('m', 5)} className="py-2 bg-indigo-50 rounded-xl hover:bg-indigo-100 text-indigo-600 font-bold text-xs">+5ÂàÜ</button>
                                        </div>
                                    </div>
                                </div>

                                <div className="pt-2">
                                    {view === 'quiz' ? (
                                        <div className="space-y-3">
                                            <button onClick={checkQuiz} className="w-full py-4 bg-indigo-600 text-white font-black rounded-2xl shadow-lg shadow-indigo-100 hover:bg-indigo-700 transition active:scale-95">Êèê‰∫§Á≠îÊ°à</button>
                                            <button onClick={generateQuiz} className="w-full py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl hover:bg-slate-200 transition flex items-center justify-center gap-2 text-sm">
                                                <Icons.RotateCcw /> Êç¢‰∏™È¢òÁõÆ
                                            </button>
                                        </div>
                                    ) : (
                                        <label className="flex items-center gap-3 p-4 bg-slate-50 rounded-2xl border border-slate-100 cursor-pointer hover:bg-slate-100 transition">
                                            <input type="checkbox" className="w-5 h-5 accent-indigo-600" checked={isManual} onChange={(e) => setIsManual(e.target.checked)} />
                                            <span className="font-bold text-slate-700">ÊâãÂä®Ëá™Áî±ÁªÉ‰π†</span>
                                        </label>
                                    )}
                                </div>

                                {feedback && (
                                    <div className={`p-4 rounded-2xl text-center font-bold animate-bounce ${feedback.type === 'success' ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-red-100 text-red-700 border border-red-200'}`}>
                                        {feedback.text}
                                    </div>
                                )}
                            </div>

                            {/* AI Story Section */}
                            <div className="bg-white rounded-3xl shadow-xl border border-amber-100 overflow-hidden">
                                <div className="bg-amber-50 p-4 border-b border-amber-100 flex items-center gap-2 text-amber-900">
                                    <Icons.Sparkles className="text-amber-500" /> <h2 className="font-bold">‚ú® AI Êó∂Èó¥Â∞èÂâßÂú∫</h2>
                                </div>
                                <div className="p-6 space-y-4 text-center">
                                    <p className="text-sm text-slate-500">ÊÉ≥Áü•ÈÅìËøô‰∏™Êó∂Èó¥Âú®ÂèëÁîü‰ªÄ‰πàÂêóÔºü</p>
                                    <button 
                                        onClick={generateTimeStory} 
                                        disabled={isGeneratingStory}
                                        className="w-full py-3 bg-gradient-to-r from-amber-400 to-orange-500 text-white font-black rounded-2xl shadow-md hover:opacity-90 disabled:opacity-50 transition"
                                    >
                                        {isGeneratingStory ? <Icons.Loader2 /> : "ËÆ≤‰∏™ÊïÖ‰∫ãÁªôÊàëÂê¨"}
                                    </button>
                                    {aiStory && (
                                        <div className="p-4 bg-amber-50 rounded-2xl border-l-4 border-amber-400 text-left animate-in slide-in-from-top-2 duration-300">
                                            <p className="text-sm text-amber-900 italic font-medium leading-relaxed">"{aiStory}"</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
